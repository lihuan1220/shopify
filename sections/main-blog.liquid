<div section-id="{{ section.id }}">
  <div class="section-background color-{{ section.settings.color_scheme }}"></div>
  <div
    class="
      section
      color-{{ section.settings.color_scheme }}
      blog-posts
      spacing-style
      size-style
    "
    style="{% render 'spacing-style', settings: section.settings %}"
  >
    {% content_for 'blocks' %}

    {%- paginate blog.articles by 12 -%}
      <div
        class="blog-posts-container"
      >
        {% for article in blog.articles %}
          <div
            class="blog-post-item"
          >
            {% content_for 'block', id: 'static-blog-post-card', type: '_blog-post-card', article: article %}
          </div>
        {% endfor %}
      </div>

      <!-- 智能分页导航 -->
      {% if paginate.pages > 1 %}
        <div class="pagination">
          <!-- 上一页 -->
          {% if paginate.previous %}
            <a href="{{ paginate.previous.url }}" class="pagination__item pagination__item--prev" aria-label="上一页">
              &lt;
            </a>
          {% else %}
            <span class="pagination__item pagination__item--disabled">&lt;</span>
          {% endif %}

          <!-- 首页 -->
          {% if paginate.current_page == 1 %}
            <span class="pagination__item pagination__item--current">1</span>
          {% else %}
            <a href="{{ paginate.path }}?page=1" class="pagination__item">1</a>
          {% endif %}

          <!-- 中间页码逻辑 -->
          {% assign total_pages = paginate.pages %}
          {% assign current_page = paginate.current_page %}

          {% if total_pages <= 7 %}
            <!-- 页数少于等于7，全部显示 -->
            {% for i in (2..total_pages) %}
              {% if i == current_page %}
                <span class="pagination__item pagination__item--current">{{ i }}</span>
              {% else %}
                <a href="{{ paginate.path }}?page={{ i }}" class="pagination__item">{{ i }}</a>
              {% endif %}
            {% endfor %}
          {% else %}
            <!-- 页数大于7，显示省略号和当前页左右各2个页码 -->
            {% assign left_gap = 2 %}
            {% assign right_gap = 2 %}
            {% assign show_left_dots = false %}
            {% assign show_right_dots = false %}

            <!-- 如果当前页左边的页码数量超过了 left_gap，则显示左边省略号 -->
            {% assign left_boundary = current_page | minus: left_gap %}
            {% if left_boundary > 2 %}
              {% assign show_left_dots = true %}
            {% endif %}

            <!-- 如果当前页右边的页码数量超过了 right_gap，则显示右边省略号 -->
            {% assign right_boundary = current_page | plus: right_gap %}
            {% assign total_minus_one = total_pages | minus: 1 %}
            {% if right_boundary < total_minus_one %}
              {% assign show_right_dots = true %}
            {% endif %}

             <!-- 左边省略号 -->
            {% if show_left_dots %}
              {% assign target_left_page = current_page | minus: 5 %}
              {% if target_left_page < 1 %}
                {% assign target_left_page = 1 %}
              {% endif %}
              <a href="{{ paginate.path }}?page={{ target_left_page }}" class="pagination__item pagination__item--dots-left"></a>
            {% endif %}

            <!-- 显示当前页左边的页码 -->
            {% assign left_start = current_page | minus: left_gap %}
            {% assign left_end = current_page | minus: 1 %}
            {% comment %} 确保起始页码不小于 2 {% endcomment %}
            {% if left_start < 2 %}
              {% assign left_start = 2 %}
            {% endif %}

            {% for i in (left_start..left_end) %}
              <a href="{{ paginate.path }}?page={{ i }}" class="pagination__item">{{ i }}</a>
            {% endfor %}

            <!-- 显示当前页 -->
            {% if current_page != 1 and current_page != total_pages %}
              <span class="pagination__item pagination__item--current">{{ current_page }}</span>
            {% endif %}

            <!-- 显示当前页右边的页码 -->
            {% assign right_start = current_page | plus: 1 %}
            {% assign right_end = current_page | plus: right_gap %}
            {% comment %} 确保结束页码不大于 total_pages - 1 {% endcomment %}
            {% if right_end > total_minus_one %}
              {% assign right_end = total_minus_one %}
            {% endif %}

            {% for i in (right_start..right_end) %}
              <a href="{{ paginate.path }}?page={{ i }}" class="pagination__item">{{ i }}</a>
            {% endfor %}

             <!-- 右边省略号 -->
            {% if show_right_dots %}
              {% assign target_right_page = current_page | plus: 5 %}
              {% if target_right_page > total_pages %}
                {% assign target_right_page = total_pages %}
              {% endif %}
              <a href="{{ paginate.path }}?page={{ target_right_page }}" class="pagination__item pagination__item--dots-right"></a>
            {% endif %}

            <!-- 显示末页 -->
            {% if current_page == total_pages %}
              <span class="pagination__item pagination__item--current">{{ total_pages }}</span>
            {% else %}
              <a href="{{ paginate.path }}?page={{ total_pages }}" class="pagination__item">{{ total_pages }}</a>
            {% endif %}
          {% endif %}

          <!-- 下一页 -->
          {% if paginate.next %}
            <a href="{{ paginate.next.url }}" class="pagination__item pagination__item--next" aria-label="下一页">
              &gt;
            </a>
          {% else %}
            <span class="pagination__item pagination__item--disabled">&gt;</span>
          {% endif %}

          <!-- 前往第X页 -->
          <div class="pagination__goto">
            <span>Go to</span>
            <input type="number" min="1" max="{{ total_pages }}" value="{{ current_page }}" autocomplete="off" class="pagination__goto-input" onblur="goToPageOnBlur(this, {{ current_page }})">
          </div>
        </div>
      {% endif %}

    {%- endpaginate -%}
  </div>
</div>

{% stylesheet %}
  /**
   * Blog posts page layout
   */
  .blog-posts {
    --page-content-width: var(--narrow-page-width);
    --page-width: calc(var(--page-content-width) + (var(--page-margin) * 2));
    --columns-gap: 36px;
    --rows-gap: 36px;
  }
  .blog-posts-container {
    display: grid;
    grid-template-columns: repeat(6, 1fr);
    gap: 1rem;
    width: 100%;
    column-gap: var(--columns-gap);
    row-gap: var(--rows-gap);
  }

  /**
   * Apart from the first and second rows in the grid, all remaining blog posts
   * are arranged in a three-column layout:
   * +------------+------------+-------------+
   * |            |            |             |
   * |  (span 2)  |  (span 2)  |  (span 2)   |
   * |            |            |             |
   * +------------+------------+-------------+
   */
  .blog-post-item {
    grid-column: span 2;
    --blog-post-card-scale: 0.6;

    @media screen and (max-width: 749px) {
      grid-column: span 6;
      --blog-post-card-scale: 0.5;
    }
  }

  /**
   * The second row of blog posts has two columns:
   * +-------------------+-------------------+
   * |                   |                   |
   * |  (column span 3)  |  (column span 3)  |
   * |                   |                   |
   * +-------------------+-------------------+
   */
  .blog-post-item:nth-child(2),
  .blog-post-item:nth-child(3) {
    grid-column: span 3;
    --blog-post-card-scale: 0.8;

    @media screen and (max-width: 749px) {
      grid-column: span 6;
      --blog-post-card-scale: 0.5;
    }
  }

  /**
   * The first row of blog posts has only one column:
   * +---------------------------------------+
   * |                                       |
   * |           (1 column span 6)           |
   * |                                       |
   * +---------------------------------------+
   */
  .blog-post-item:first-child {
    grid-column: span 6;
    --blog-post-card-scale: 1;
  }

  /**
   * When there's no image, the blog post item has a border.
   */
  .blog-post-item {
    border: 1px solid rgba(from var(--color-foreground) r g b / 0.2);
    padding: 0 1rem 1rem;
  }
  .blog-post-item:has(.blog-post-card__image-container) {
    border: none;
    padding: 0;
  }

  /* ========== 分页样式 ========== */
  .pagination {
    display: flex;
    justify-content: center;
    align-items: center;
    margin-top: 3rem;
    gap: 4px;
  }

  .pagination__item {
    display: inline-block;
    font-size: 16px;
    min-width: 2rem;
    height: 2rem;
    line-height: 2rem;
    text-align: center;
    text-decoration: none;
    color: #000000;
    cursor: pointer;
  }

  .pagination__item:hover {
    color: #47B92D;
  }

  .pagination__item--current {
    color: #47B92D;
  }

  .pagination__item--disabled {
    color: #c0c4cc;
    pointer-events: none;
    cursor: not-allowed;
  }

  .pagination__item--dots-left::before {
    content: "...";
  }

  .pagination__item--dots-left:hover::before {
    content: '<';
  }

  .pagination__item--dots-right::before {
    content: "...";
  }

  .pagination__item--dots-right:hover::before {
    content: '>';
  }

  .pagination__item--prev,
  .pagination__item--next {
    font-size: 16px;
  }


  /* ========== 前往第X页样式 ========== */
  .pagination__goto {
    display: flex;
    align-items: center;
    gap: 4px;
    margin-left: 1rem;
    white-space: nowrap;
    color: #606266;
  }

  .pagination__goto-input {
    color: #606266;
    background-color: #ffffff;
    background-image: none;
    border-radius: 4px;
    border: 1px solid #dcdfe6;
    box-sizing: border-box;
    display: inline-block;
    font-size: inherit;
    height: 28px;
    outline: none;
    padding: 0 3px;
    width: 50px;
    text-align: center;
    cursor: pointer;
  }

  /* 隐藏数字输入框的上下箭头 */
  .pagination__goto-input::-webkit-outer-spin-button,
  .pagination__goto-input::-webkit-inner-spin-button {
    -webkit-appearance: none;
    margin: 0;
  }

  .pagination__goto-input[type=number] {
    -moz-appearance: textfield;
    -webkit-appearance: none;
    appearance: none;
  }

  .pagination__goto-input:hover,
  .pagination__goto-input:focus {
    outline: none;
    border-color: #47B92D;
    background-color: #ffffff;
    color: #000000;
  }

  @media (max-width: 768px) {
    .pagination {
      transform: scale(0.8);
    }
  }
{% endstylesheet %}

<script>
  function goToPageOnBlur(input, currentPage) {
    const page = parseInt(input.value);
    const totalPages = parseInt(input.max);

    // 检查输入是否为空
    if (input.value === '') {
      return;
    }

    // 检查是否是有效数字
    if (isNaN(page)) {
      input.value = '';
      return;
    }

    // 检查是否在有效范围内
    if (page < 1 || page > totalPages) {
      input.value = '';
      return;
    }

    // 检查是否与当前页相同
    if (page === currentPage) {
      return; // 不执行任何操作
    }

    // 构造目标页面的 URL
    const url = new URL(window.location.href);
    url.searchParams.set('page', page);
    url.hash = ''; // 清除锚点

    // 跳转到指定页面
    window.location.href = url.toString();
  }
</script>

{% schema %}
{
  "name": "t:names.blog_posts",
  "blocks": [
    {
      "type": "@theme"
    },
    {
      "type": "@app"
    },
    {
      "type": "text"
    },
    {
      "type": "icon"
    },
    {
      "type": "image"
    },
    {
      "type": "button"
    },
    {
      "type": "video"
    },
    {
      "type": "group"
    },
    {
      "type": "spacer"
    },
    {
      "type": "_divider"
    }
  ],
  "disabled_on": {
    "groups": ["header"]
  },
  "settings": [
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "t:settings.color_scheme",
      "default": "scheme-1"
    },
    {
      "type": "header",
      "content": "t:content.padding"
    },
    {
      "type": "range",
      "id": "padding-block-start",
      "label": "t:settings.top",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "default": 0
    },
    {
      "type": "range",
      "id": "padding-block-end",
      "label": "t:settings.bottom",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "default": 0
    }
  ]
}
{% endschema %}